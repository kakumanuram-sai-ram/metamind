{
  "dashboard_id": 657,
  "dashboard_title": "Zomato Tracking",
  "dashboard_url": "https://cdp-dataview.platform.mypaytm.com/superset/dashboard/657/",
  "owner": "Unknown",
  "created_on": "",
  "changed_on": "2025-09-30T06:26:17.520264",
  "charts": [
    {
      "chart_id": 3083,
      "chart_name": "Zomato Tracking Sept25",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1326,
      "dataset_name": "zomato Tracking(Zomato NRR)",
      "database_name": "Trino",
      "sql_query": "SELECT day_id AS day_id, sum(dau) AS \"Dau__\", sum(mau) AS \"Mau\", sum(zomato_ft) AS \"Zomato_FT\", sum(\"zomato_ft_paytm_NR\") AS \"Zomato_ft_paytm_nr\", sum(zomato_ft_paytm_new) AS zomato_ft_paytm_new, sum(zomato_ft_paytm_react) AS \"Zomato_ft_paytm_react\", sum(n_txns) AS n_txns, sum(gmv) AS gmv, sum(zomato_ft_199_mov) AS \"Zomato_FT_199/149_mov\" \nFROM (with upi_reference_table as (\nselect a.*, date_trunc('month',day_id) mnt\nfrom (\nselect\ndate(txn_timestamp) day_id, \ncustomer_id_payer AS customer_id,\ntxn_timestamp created_on,\ntxn_id,\namount,\npayee_vpa,\nCASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_category,\nrow_number() over (partition by customer_id_payer, date_trunc('month', date(txn_timestamp)) order by txn_timestamp) as rn_ft\nFROM  hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >=DATE'2025-09-01'\n  AND transaction_date_key  >= DATE'2025-09-01'\n  AND status IN ('SUCCESS','DEEMED')\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n    )a\nleft JOIN  hive.user_paytm_payments.upi_3p_online_merchant_vpa_mapping b on LOWER(a.payee_vpa) = LOWER(b.payee_vpa)\nWHERE lower(b.online_merchant_name) = 'zomato' --## change later\nor lower(a.payee_vpa) in(\n'zomato3.payu@icici'\n,'zomatolimited@indus'\n,'zomatolimited311768.rzp@axisbank'\n,'rzpfbcduozomatolimited@yesbank'\n,'zomatolimited13.rzp@mairtel'\n,'zomatolimited725890.rzp@rxairtel'\n,'zomatoforenterp205994.rzp@rxairtel'\n,'zomatolimitedbdr.rzp@mairtel'\n,'rzpecisrpzomatoforenterprise@yesbank'\n,'zomatoforenterp392037.rzp@axisbank'\n,'zomatoforenterp548800.rzp@hdfcbank'\n,'zomatoforenterp266812.rzp@rxaxis'\n,'paytm-83855874@ptybl'\n,'zomatohyperpure224466.rzp@rxairtel'\n)\n),\npaytm_nrr AS (\n      SELECT customer_id customer_id, date_trunc('month',date(txn_date) ) mnt,\n      CASE\n      WHEN user_type = 'New' THEN 'New'\n      WHEN user_type = 'Repeat' THEN 'Repeat'\n      ELSE 'React_2M+'\n      END AS user_type\n      FROM  hive.user_paytm_payments.rolling_nrr_v1\n      WHERE txn_date >= date'2025-09-01'\n      and user_type Not IN ('Repeat')\n        and\n        customer_Id not in (\n        Select cust_id from hive.user_paytm_payments.ft_base_with_mapping_raw_rolling_nrr_with_online --set of user is already tagged\n        where dt >=  date'2025-09-01'--date_trunc('month',current_Date - interval  '01' day - interval '01' month)\n         and lower(channel) in ('fmcg','masu online','masu offline','1. masu offline via fse','2. masu via p4b app','3. masu via paytm app','4. merchant gets user offline via qr code','5. merchant gets user via soundbox','6. merchant gets user via referral (p4b app)','7. fse as payer'\n                 ,'1.a. fse gets merchants as user'\n        ,'1.b. fse gets merchants as other'\n         )\n        union all\n        Select cust_id from hive.user_paytm_payments.ft_base_with_mapping_raw_rolling_nrr_with_online_cm\n        where dt >=  date'2025-09-01'--date_trunc('month',current_Date - interval  '01' day - interval '01' month)\n        and lower(channel) in ('fmcg','masu online','masu offline','1. masu offline via fse','2. masu via p4b app','3. masu via paytm app','4. merchant gets user offline via qr code','5. merchant gets user via soundbox','6. merchant gets user via referral (p4b app)','7. fse as payer'\n                ,'1.a. fse gets merchants as user'\n        ,'1.b. fse gets merchants as other'\n        )\n        )\n      ),\n\nzomato_nrr as (\n   select customer_id, ft_Date, date_trunc('month',ft_Date) mnt from user_paytm_payments.Online_merchant_Zomato_NRR\n   where ft_Date >= date'2025-09-01'\n   and lifecycle = 'a:new'\n)\n----------------------------------------------------------------------------------------------------------------------------------------------------------------\nselect\nday_id,\n    count(distinct a.customer_id) as dau,\n    count(distinct case when a.rn_mau = 1 then a.customer_id end) as mau,\n    count(distinct case when a.rn_mau = 1 and b.customer_id is not null then a.customer_id  end) as zomato_ft, --- paytm new/react\n    count(distinct case when a.rn_mau = 1 and b.customer_id is not null and rn_ft = 1 and c.customer_id is not null then a.customer_id  end) as zomato_ft_paytm_NR, \n    count(distinct case when a.rn_mau = 1 and b.customer_id is not null and rn_ft = 1 and c.user_type = 'New' then a.customer_id  end) as zomato_ft_paytm_new, \n    count(distinct case when a.rn_mau = 1 and b.customer_id is not null and rn_ft = 1 and c.user_type = 'React_2M+' then a.customer_id  end) as zomato_ft_paytm_react,\n    count(distinct case when a.rn_mau = 1 and b.customer_id is not null and a.amount >= case when day_id<= date'2025-11-06' then 199 else 149 end then a.customer_id  end) as zomato_ft_199_mov, --- paytm new/react\n    count(distinct a.txn_id) as n_txns,\n    sum(cast (amount as double)) as gmv\nfrom\n(\nselect day_id,txn_id,customer_id,amount,rn_ft,mnt,\n--row_number() over (partition by customer_id, date_trunc('month', day_id) , day_id>= date'2025-09-18' order by day_id) as rn_mau\nrow_number() over (partition by customer_id, date_trunc('month', day_id) order by day_id) as rn_mau\nfrom  upi_reference_table a\n        where   final_category = 'Online'\n            and day_id >= date'2025-09-01'--date_trunc('month',current_Date - interval  '01' day - interval '01' month)\n)a\n--left join paytm_nrr b on a.customer_id = b.customer_id  and a.mnt = b.mnt\nleft join zomato_nrr b on a.customer_id = b.customer_id  and a.mnt = b.mnt\nleft join paytm_nrr c on a.customer_id = c.customer_id  and a.mnt = c.mnt\n\ngroup by 1\nORDER BY 1\n) AS virtual_table GROUP BY day_id ORDER BY sum(dau) ASC\nLIMIT 1000;\n\n",
      "metrics": [
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "dau",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30030,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Dau",
          "optionName": "metric_r2x3vtiw27k_rmbxkbn4t2m"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "mau",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30031,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Mau",
          "optionName": "metric_911muc8ettf_ooyu7g7r3q"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "zomato_ft",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30032,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Zomato_FT",
          "optionName": "metric_8haiw51v65l_n25iye5m1l"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "zomato_ft_paytm_NR",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30033,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Zomato_ft_paytm_nr",
          "optionName": "metric_acf8uifa2d_xczbkggl8p"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "zomato_ft_paytm_new",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30034,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "zomato_ft_paytm_new",
          "optionName": "metric_9jbsraj0pyu_gmdo3eb0e89"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "zomato_ft_paytm_react",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30035,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Zomato_ft_paytm_react",
          "optionName": "metric_ltmqm0810dm_25lfhi9nly9"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "n_txns",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30037,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "n_txns",
          "optionName": "metric_5hbvgszodwk_tiv19mkmkq"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "gmv",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30038,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "DOUBLE",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "gmv",
          "optionName": "metric_sjgikoa5mlf_4xnsvn4acf8"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "zomato_ft_199_mov",
            "description": null,
            "expression": "",
            "filterable": true,
            "groupby": true,
            "id": 30036,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Zomato_FT_199/149_mov",
          "optionName": "metric_jx59t2u7zsd_p73x9yi2k6n"
        }
      ],
      "columns": [
        "day_id",
        "dau",
        "mau",
        "zomato_ft",
        "zomato_ft_paytm_NR",
        "zomato_ft_paytm_new",
        "zomato_ft_paytm_react",
        "zomato_ft_199_mov",
        "n_txns",
        "gmv"
      ],
      "groupby_columns": [],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "expressionType": "SIMPLE",
          "operator": "TEMPORAL_RANGE",
          "subject": "day_id"
        }
      ],
      "time_range": null
    }
  ]
}