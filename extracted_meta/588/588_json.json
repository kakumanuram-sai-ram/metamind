{
  "dashboard_id": 588,
  "dashboard_title": "UPI SR Monitoring (T & T-1)",
  "dashboard_url": "https://cdp-dataview.platform.mypaytm.com/superset/dashboard/588/",
  "owner": "Unknown",
  "created_on": "",
  "changed_on": "2025-10-28T09:43:17.797934",
  "charts": [
    {
      "chart_id": 2823,
      "chart_name": "Hourly SR Trend (T vs T-1)- 588",
      "chart_type": "echarts_timeseries_line",
      "dataset_id": 1133,
      "dataset_name": "UPI SR Monitoring (T & T-1)",
      "database_name": "Trino",
      "sql_query": "SELECT hour(created_on) AS \"Hour\", dt AS dt, (COUNT(txn_id) filter(WHERE status = 'SUCCESS')*1.0000) / (COUNT(txn_id)*1.0000) AS \"SR\" \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table GROUP BY hour(created_on), dt ORDER BY \"SR\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "expressionType": "SQL",
          "sqlExpression": "(COUNT(txn_id) filter(WHERE status = 'SUCCESS')*1.0000) / (COUNT(txn_id)*1.0000)",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_1pqt874jw2y_8i05n1gotmg"
        }
      ],
      "columns": [
        "final_Category",
        "payee_handle",
        "payer_cust_id",
        "flow_cat",
        "payer_account_type",
        "payer_bank",
        "created_on",
        "dt",
        "date_time_hourly",
        "txn_id",
        "amount",
        "Error_code",
        "status",
        "payer_vpa",
        "payer_handle",
        "payee_bank"
      ],
      "groupby_columns": [
        "dt"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "subject": "created_on",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "expressionType": "SIMPLE"
        },
        {
          "clause": "WHERE",
          "subject": "date_time_hourly",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "expressionType": "SIMPLE"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 2824,
      "chart_name": "Top Error Codes (T vs T-1)- 588",
      "chart_type": "table",
      "dataset_id": 1133,
      "dataset_name": "UPI SR Monitoring (T & T-1)",
      "database_name": "Trino",
      "sql_query": "SELECT \"Error_code\" AS \"Error_code\", COUNT(txn_id)filter(where date(created_on) = (date(current_time_)- interval '01' day)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n) AS \"Yday Failure\", COUNT(txn_id)\nfilter(\nwhere date(created_on) = date(current_time_)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n) AS \"Today Failure\", case when COUNT(txn_id)filter(where date(created_on) = (date(current_time_) - interval '01' day)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n) = 0 then 0 else\n\n(\nCOUNT(txn_id)\nfilter(\nwhere date(created_on) = date(current_time_)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n)\n*1.0000\n)/\n(\nCOUNT(txn_id)filter(where date(created_on) = (date(current_time_)- interval '01' day)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n)*1.0000\n)-1\nend AS \"Failure Growth\" \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table \nWHERE status IN ('FAILURE') GROUP BY \"Error_code\" ORDER BY \"Yday Failure\" DESC\nLIMIT 20;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yday Failure",
          "optionName": "metric_35kz7nbgkgg_e1l9qeca4p",
          "sqlExpression": "COUNT(txn_id)filter(where date(created_on) = (date(current_time_)- interval '01' day)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Today Failure",
          "optionName": "metric_062jdcypcwo6_dfuajwfeg3c",
          "sqlExpression": "COUNT(txn_id)\nfilter(\nwhere date(created_on) = date(current_time_)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Failure Growth",
          "optionName": "metric_z85gb6v2n2o_w9ap5lp4j9p",
          "sqlExpression": "case when COUNT(txn_id)filter(where date(created_on) = (date(current_time_) - interval '01' day)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n) = 0 then 0 else\n\n(\nCOUNT(txn_id)\nfilter(\nwhere date(created_on) = date(current_time_)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n)\n*1.0000\n)/\n(\nCOUNT(txn_id)filter(where date(created_on) = (date(current_time_)- interval '01' day)\nand hour(created_on) <= hour(\n(current_time_ - interval '01' hour))\n)*1.0000\n)-1\nend"
        }
      ],
      "columns": [
        "final_Category",
        "payee_handle",
        "payer_cust_id",
        "flow_cat",
        "payer_account_type",
        "payer_bank",
        "created_on",
        "dt",
        "date_time_hourly",
        "txn_id",
        "amount",
        "Error_code",
        "status",
        "payer_vpa",
        "payer_handle",
        "payee_bank"
      ],
      "groupby_columns": [
        "Error_code"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_z3vttfvp9k_j40lksh9hup",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "created_on"
        },
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_4cxqob30aov_fp6iqfc4msk",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "date_time_hourly"
        },
        {
          "clause": "WHERE",
          "comparator": [
            "FAILURE"
          ],
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_yqeg1vptzo_f3jgqjhsdlb",
          "isExtra": false,
          "isNew": false,
          "operator": "IN",
          "operatorId": "IN",
          "sqlExpression": null,
          "subject": "status"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 2825,
      "chart_name": "Top Bank Codes (T vs T-1)- 588",
      "chart_type": "table",
      "dataset_id": 1133,
      "dataset_name": "UPI SR Monitoring (T & T-1)",
      "database_name": "Trino",
      "sql_query": "SELECT payee_handle AS payee_handle, COUNT(txn_id)filter(where date(created_on) = (date(current_time_)- interval '01' day)\nand hour(created_on) <= hour(\n(cast(current_time_ as TIMESTAMP) - interval '01' hour))\n) AS \"Yday Failure\", COUNT(txn_id)\nfilter(\nwhere date(created_on) = (date(current_time_))\nand hour(created_on) <= hour(\n(cast(current_time_ as TIMESTAMP) - interval '01' hour))\n) AS \"Today Failure\", case when COUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast(current_time as TIMESTAMP) - interval '01' hour))\n) = 0 then 0 else\n\n(\nCOUNT(txn_id)\nfilter(\nwhere date(created_on) = (current_date)\nand hour(created_on) <= hour(\n(cast(current_time as TIMESTAMP) - interval '01' hour))\n)\n*1.0000\n)/\n(\nCOUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast(current_time as TIMESTAMP) - interval '01' hour))\n)*1.0000\n)-1\nend AS \"Failure Growth\" \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table \nWHERE status IN ('FAILURE') GROUP BY payee_handle ORDER BY \"Yday Failure\" DESC\nLIMIT 20;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yday Failure",
          "optionName": "metric_35kz7nbgkgg_e1l9qeca4p",
          "sqlExpression": "COUNT(txn_id)filter(where date(created_on) = (date(current_time_)- interval '01' day)\nand hour(created_on) <= hour(\n(cast(current_time_ as TIMESTAMP) - interval '01' hour))\n)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Today Failure",
          "optionName": "metric_062jdcypcwo6_dfuajwfeg3c",
          "sqlExpression": "COUNT(txn_id)\nfilter(\nwhere date(created_on) = (date(current_time_))\nand hour(created_on) <= hour(\n(cast(current_time_ as TIMESTAMP) - interval '01' hour))\n)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Failure Growth",
          "optionName": "metric_z85gb6v2n2o_w9ap5lp4j9p",
          "sqlExpression": "case when COUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast(current_time as TIMESTAMP) - interval '01' hour))\n) = 0 then 0 else\n\n(\nCOUNT(txn_id)\nfilter(\nwhere date(created_on) = (current_date)\nand hour(created_on) <= hour(\n(cast(current_time as TIMESTAMP) - interval '01' hour))\n)\n*1.0000\n)/\n(\nCOUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast(current_time as TIMESTAMP) - interval '01' hour))\n)*1.0000\n)-1\nend"
        }
      ],
      "columns": [
        "final_Category",
        "payee_handle",
        "payer_cust_id",
        "flow_cat",
        "payer_account_type",
        "payer_bank",
        "created_on",
        "dt",
        "date_time_hourly",
        "txn_id",
        "amount",
        "Error_code",
        "status",
        "payer_vpa",
        "payer_handle",
        "payee_bank"
      ],
      "groupby_columns": [
        "payee_handle"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_z3vttfvp9k_j40lksh9hup",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "created_on"
        },
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_4cxqob30aov_fp6iqfc4msk",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "date_time_hourly"
        },
        {
          "clause": "WHERE",
          "comparator": [
            "FAILURE"
          ],
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_yqeg1vptzo_f3jgqjhsdlb",
          "isExtra": false,
          "isNew": false,
          "operator": "IN",
          "operatorId": "IN",
          "sqlExpression": null,
          "subject": "status"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3174,
      "chart_name": "PSP wise (T vs T-1)- 588",
      "chart_type": "table",
      "dataset_id": 1133,
      "dataset_name": "UPI SR Monitoring (T & T-1)",
      "database_name": "Trino",
      "sql_query": "SELECT Lower(payer_handle) AS payer_handle, COUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n) AS \"Yday Failure\", COUNT(txn_id)\nfilter(\nwhere date(created_on) = (current_date)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n )\n  AS \"Today Failure\", case when COUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n) = 0 then 0 else\n\n(\nCOUNT(txn_id)\nfilter(\nwhere date(created_on) = (current_date)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n)\n*1.0000\n)/\n(\nCOUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n)*1.0000\n)-1\nend AS \"Failure Growth\" \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table \nWHERE status IN ('FAILURE') GROUP BY Lower(payer_handle) ORDER BY \"Yday Failure\" DESC\nLIMIT 100;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yday Failure",
          "optionName": "metric_35kz7nbgkgg_e1l9qeca4p",
          "sqlExpression": "COUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Today Failure",
          "optionName": "metric_062jdcypcwo6_dfuajwfeg3c",
          "sqlExpression": "COUNT(txn_id)\nfilter(\nwhere date(created_on) = (current_date)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n )\n "
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Failure Growth",
          "optionName": "metric_z85gb6v2n2o_w9ap5lp4j9p",
          "sqlExpression": "case when COUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n) = 0 then 0 else\n\n(\nCOUNT(txn_id)\nfilter(\nwhere date(created_on) = (current_date)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n)\n*1.0000\n)/\n(\nCOUNT(txn_id)filter(where date(created_on) = (current_date- interval '01' day)\nand hour(created_on) <= hour(\n(cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '01' hour))\n)*1.0000\n)-1\nend"
        }
      ],
      "columns": [
        "final_Category",
        "payee_handle",
        "payer_cust_id",
        "flow_cat",
        "payer_account_type",
        "payer_bank",
        "created_on",
        "dt",
        "date_time_hourly",
        "txn_id",
        "amount",
        "Error_code",
        "status",
        "payer_vpa",
        "payer_handle",
        "payee_bank"
      ],
      "groupby_columns": [
        {
          "label": "payer_handle",
          "sqlExpression": "Lower(payer_handle)",
          "expressionType": "SQL"
        }
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_z3vttfvp9k_j40lksh9hup",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "created_on"
        },
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_4cxqob30aov_fp6iqfc4msk",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "date_time_hourly"
        },
        {
          "clause": "WHERE",
          "comparator": [
            "FAILURE"
          ],
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_yqeg1vptzo_f3jgqjhsdlb",
          "isExtra": false,
          "isNew": false,
          "operator": "IN",
          "operatorId": "IN",
          "sqlExpression": null,
          "subject": "status"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3229,
      "chart_name": "Top Error Codes X Bank (T vs T-1)- 588",
      "chart_type": "table",
      "dataset_id": 1324,
      "dataset_name": "UPI SR Monitoring(T & T-1) error x bank",
      "database_name": "Trino",
      "sql_query": "SELECT error_code AS error_code, payer_bank AS payer_bank, sum(total_today_failures) AS \"Today Failure\", sum(total_yest_failures) AS \"Yday Failure\", sum(total_today_failures*1.000)\n/\nsum(total_yest_failures*1.000)\n-1 AS \"Failure Growth\" \nFROM (WITH BankFailures AS (\nSELECT \nerror_code error_code,\npayer_bank payer_bank,\ncount(txn_id) filter(where date(created_on)  = (current_date - interval '01' day)) n_yest_failures,\ncount(txn_id) filter(where date(created_on)  = (current_date )) n_today_failures\nFROM\n (\nSELECT \"final_Category\" AS \"final_Category\", payee_handle AS payee_handle, payer_cust_id AS payer_cust_id, flow_cat AS flow_cat, payer_account_type AS payer_account_type, payer_bank AS payer_bank, created_on AS created_on, dt AS dt, date_time_hourly AS date_time_hourly, txn_id AS txn_id, amount AS amount, \"Error_code\" AS \"Error_code\", status AS status, payer_vpa AS payer_vpa, payer_handle AS payer_handle, payee_bank AS payee_bank \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table\n) AS dataset_1133\n where payer_handle in('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and error_code is Not null\ngroup by 1,2\n),\n      TopBanks AS (\n          SELECT payer_bank\n          FROM (\n              SELECT payer_bank,\n                  ROW_NUMBER() OVER (ORDER BY SUM(n_today_failures) DESC, SUM(n_yest_failures) DESC) AS rn\n              FROM BankFailures\n              GROUP BY payer_bank\n          ) ranked\n          WHERE rn <= 5\n      ),\n      TopBankCodes AS (\n          SELECT payer_bank, error_code\n          FROM (\n              SELECT payer_bank, error_code,\n                  ROW_NUMBER() OVER (PARTITION BY payer_bank ORDER BY n_today_failures DESC, n_yest_failures DESC) AS rn\n              FROM BankFailures\n          ) ranked\n          WHERE rn <= 5\n      )\n      SELECT\n          tbc.payer_bank,\n          tbc.error_code,\n          SUM(bf.n_yest_failures) AS total_yest_failures,\n          SUM(bf.n_today_failures) AS total_today_failures\n      FROM BankFailures bf\n      JOIN TopBanks tb ON bf.payer_bank = tb.payer_bank\n      JOIN TopBankCodes tbc ON bf.payer_bank = tbc.payer_bank\n          AND (bf.error_code = tbc.error_code OR (bf.error_code IS NULL AND tbc.error_code IS NULL))\n      GROUP BY tbc.payer_bank, tbc.error_code\n      ORDER BY total_today_failures DESC, total_yest_failures DESC\n) AS virtual_table \nWHERE error_code IS NOT NULL GROUP BY error_code, payer_bank ORDER BY \"Today Failure\" DESC\nLIMIT 50;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Today Failure",
          "optionName": "metric_87jnrg5bu83_6x31ujwz1z3",
          "sqlExpression": "sum(total_today_failures)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yday Failure",
          "optionName": "metric_35kz7nbgkgg_e1l9qeca4p",
          "sqlExpression": "sum(total_yest_failures)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Failure Growth",
          "optionName": "metric_evnxgtsp4af_x0imqqefcnl",
          "sqlExpression": "sum(total_today_failures*1.000)\n/\nsum(total_yest_failures*1.000)\n-1"
        }
      ],
      "columns": [
        "payer_bank",
        "error_code",
        "total_yest_failures",
        "total_today_failures"
      ],
      "groupby_columns": [
        "error_code",
        "payer_bank"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": null,
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_guo4jb6gvow_7s5cs09usob",
          "isExtra": false,
          "isNew": false,
          "operator": "IS NOT NULL",
          "operatorId": "IS_NOT_NULL",
          "sqlExpression": null,
          "subject": "error_code"
        },
        {
          "clause": "WHERE",
          "subject": "day_id",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "expressionType": "SIMPLE"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3751,
      "chart_name": "Top Error Codes X Payer Handle (T vs T-1) : Exc (U30-Z9 & U30-ZM)- 588",
      "chart_type": "table",
      "dataset_id": 1436,
      "dataset_name": "UPI SR Monitoring(T & T-1) error x payer_handle",
      "database_name": "Trino",
      "sql_query": "SELECT error_code AS error_code, payer_handle AS payer_handle, sum(total_today_failures) AS \"Today's Failure\", sum(total_yest_failures) AS \"Yesterday's Failure\", case when sum(total_yest_failures)  = 0 then 0 else\n\n(\nsum(total_today_failures) *1.0000\n)/\n(\nsum(total_yest_failures) *1.0000\n)-1\nend AS \"Growth\" \nFROM (WITH Payer_handle_Failures AS (\nSELECT \nerror_code error_code,\npayer_handle payer_handle,\ncount(txn_id) filter(where date(created_on)  = (current_date - interval '01' day)) n_yest_failures,\ncount(txn_id) filter(where date(created_on)  = (current_date )) n_today_failures\nFROM\n (\nSELECT \"final_Category\" AS \"final_Category\", payee_handle AS payee_handle, payer_cust_id AS payer_cust_id, flow_cat AS flow_cat, payer_account_type AS payer_account_type, payer_bank AS payer_bank, created_on AS created_on, dt AS dt, date_time_hourly AS date_time_hourly, txn_id AS txn_id, amount AS amount, \"Error_code\" AS \"Error_code\", status AS status, payer_vpa AS payer_vpa, payer_handle AS payer_handle, payee_bank AS payee_bank \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table\n) AS dataset_1133\n where payer_handle in('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n and error_code is Not null\ngroup by 1,2\n),\n      Top_Payer_handle AS (\n          SELECT payer_handle\n          FROM (\n              SELECT payer_handle,\n                  ROW_NUMBER() OVER (ORDER BY SUM(n_today_failures) DESC, SUM(n_yest_failures) DESC) AS rn\n              FROM Payer_handle_Failures\n              GROUP BY payer_handle\n          ) ranked\n          WHERE rn <= 5\n      ),\n      Top_Payer_handle_codes AS (\n          SELECT payer_handle, error_code\n          FROM (\n              SELECT payer_handle, error_code,\n                  ROW_NUMBER() OVER (PARTITION BY payer_handle ORDER BY n_today_failures DESC, n_yest_failures DESC) AS rn\n              FROM Payer_handle_Failures\n          ) ranked\n          WHERE rn <= 5\n      )\n      SELECT\n          tbc.payer_handle,\n          tbc.error_code,\n          SUM(bf.n_yest_failures) AS total_yest_failures,\n          SUM(bf.n_today_failures) AS total_today_failures\n      FROM Payer_handle_Failures bf\n      JOIN Top_Payer_handle tb ON bf.payer_handle = tb.payer_handle\n      JOIN Top_Payer_handle_codes tbc ON bf.payer_handle = tbc.payer_handle\n          AND (bf.error_code = tbc.error_code OR (bf.error_code IS NULL AND tbc.error_code IS NULL))\n      GROUP BY tbc.payer_handle, tbc.error_code\n      ORDER BY total_today_failures DESC, total_yest_failures DESC\n) AS virtual_table \nWHERE error_code IS NOT NULL GROUP BY error_code, payer_handle ORDER BY \"Today's Failure\" DESC\nLIMIT 1000;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Today's Failure",
          "optionName": "metric_1hq9y7pn5dc_qpc4x8w1w5g",
          "sqlExpression": "sum(total_today_failures)\n"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_7agkrxg36xs_jxwxpnhsu6",
          "sqlExpression": "sum(total_yest_failures)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Growth",
          "optionName": "metric_0267zsqgl5z3_4lyxurf6bm7",
          "sqlExpression": "case when sum(total_yest_failures)  = 0 then 0 else\n\n(\nsum(total_today_failures) *1.0000\n)/\n(\nsum(total_yest_failures) *1.0000\n)-1\nend"
        }
      ],
      "columns": [
        "total_yest_failures",
        "total_today_failures",
        "payer_handle",
        "error_code"
      ],
      "groupby_columns": [
        "error_code",
        "payer_handle"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": null,
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_i3h9dqz0v3a_jx6gj4cx1rf",
          "isExtra": false,
          "isNew": false,
          "operator": "IS NOT NULL",
          "operatorId": "IS_NOT_NULL",
          "sqlExpression": null,
          "subject": "error_code"
        },
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "expressionType": "SIMPLE",
          "operator": "TEMPORAL_RANGE",
          "subject": "day_id"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3783,
      "chart_name": "Top Error Codes X Payee Handle (T vs T-1): Exc (U30-Z9 & U30-ZM)- 588",
      "chart_type": "table",
      "dataset_id": 1641,
      "dataset_name": "UPI SR Monitoring(T & T-1) error x payee Handle",
      "database_name": "Trino",
      "sql_query": "SELECT error_code AS error_code, payee_handle AS payee_handle, sum(total_today_failures) AS \"Today Failure\", sum(total_yest_failures) AS \"Yday Failure\", sum(total_today_failures*1.0000)/\nsum(total_yest_failures*1.0000)-1 AS \"Failure Growth\" \nFROM (WITH Payee_handle_Failures AS (\nSELECT \nerror_code error_code,\npayee_handle payee_handle,\ncount(txn_id) filter(where date(created_on)  = (current_date - interval '01' day)) n_yest_failures,\ncount(txn_id) filter(where date(created_on)  = (current_date )) n_today_failures\nFROM\n (\nSELECT \"final_Category\" AS \"final_Category\", payee_handle AS payee_handle, payer_cust_id AS payer_cust_id, flow_cat AS flow_cat, payer_account_type AS payer_account_type, payer_bank AS payer_bank, created_on AS created_on, dt AS dt, date_time_hourly AS date_time_hourly, txn_id AS txn_id, amount AS amount, \"Error_code\" AS \"Error_code\", status AS status, payer_vpa AS payer_vpa, payer_handle AS payer_handle, payee_bank AS payee_bank \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table\n) AS dataset_1133\n where payer_handle in('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n and error_code not in('U30-Z9','U30-ZM')\ngroup by 1,2\n),\n      Top_payee_handle AS (\n          SELECT payee_handle\n          FROM (\n              SELECT payee_handle,\n                  ROW_NUMBER() OVER (ORDER BY SUM(n_today_failures) DESC, SUM(n_yest_failures) DESC) AS rn\n              FROM Payee_handle_Failures\n              GROUP BY payee_handle\n          ) ranked\n          WHERE rn <= 5\n      ),\n      Top_payee_handle_code AS (\n          SELECT payee_handle, error_code\n          FROM (\n              SELECT payee_handle, error_code,\n                  ROW_NUMBER() OVER (PARTITION BY payee_handle ORDER BY n_today_failures DESC, n_yest_failures DESC) AS rn\n              FROM Payee_handle_Failures\n          ) ranked\n          WHERE rn <= 5\n      )\n      SELECT\n          tbc.payee_handle,\n          tbc.error_code,\n          SUM(bf.n_yest_failures) AS total_yest_failures,\n          SUM(bf.n_today_failures) AS total_today_failures\n      FROM Payee_handle_Failures bf\n      JOIN Top_payee_handle tb ON bf.payee_handle = tb.payee_handle\n      JOIN Top_payee_handle_Code tbc ON bf.payee_handle = tbc.payee_handle\n          AND (bf.error_code = tbc.error_code OR (bf.error_code IS NULL AND tbc.error_code IS NULL))\n      GROUP BY tbc.payee_handle, tbc.error_code\n      ORDER BY total_today_failures DESC, total_yest_failures DESC\n) AS virtual_table \nWHERE error_code IS NOT NULL GROUP BY error_code, payee_handle ORDER BY \"Today Failure\" DESC\nLIMIT 100;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Today Failure",
          "optionName": "metric_87jnrg5bu83_6x31ujwz1z3",
          "sqlExpression": "sum(total_today_failures)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yday Failure",
          "optionName": "metric_35kz7nbgkgg_e1l9qeca4p",
          "sqlExpression": "sum(total_yest_failures)"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Failure Growth",
          "optionName": "metric_evnxgtsp4af_x0imqqefcnl",
          "sqlExpression": "sum(total_today_failures*1.0000)/\nsum(total_yest_failures*1.0000)-1"
        }
      ],
      "columns": [
        "payee_handle",
        "error_code",
        "total_yest_failures",
        "total_today_failures"
      ],
      "groupby_columns": [
        "error_code",
        "payee_handle"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": null,
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_guo4jb6gvow_7s5cs09usob",
          "isExtra": false,
          "isNew": false,
          "operator": "IS NOT NULL",
          "operatorId": "IS_NOT_NULL",
          "sqlExpression": null,
          "subject": "error_code"
        },
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "expressionType": "SIMPLE",
          "operator": "TEMPORAL_RANGE",
          "subject": "day_id"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3852,
      "chart_name": "UPI SR Monitoring(T & T-1) Top 10 Remiter Bank",
      "chart_type": "echarts_timeseries_bar",
      "dataset_id": 1678,
      "dataset_name": "UPI SR Monitoring(T & T-1) Top Bank total and failed txns",
      "database_name": "Trino",
      "sql_query": "SELECT payer_bank AS payer_bank, dt AS dt, (sum(Success_txns)*1.0000)/\n(SUM(total_Txn)*1.00000) AS \"SR\" \nFROM (with A as(\nSELECT  created_on created_on, status status,payer_bank payer_bank, count(txn_id) txns\nFROM\n(\nSELECT \"final_Category\" AS \"final_Category\", payee_handle AS payee_handle, payer_cust_id AS payer_cust_id, flow_cat AS flow_cat, payer_account_type AS payer_account_type, payer_bank AS payer_bank, created_on AS created_on, dt AS dt, date_time_hourly AS date_time_hourly, txn_id AS txn_id, amount AS amount, \"Error_code\" AS \"Error_code\", status AS status, payer_vpa AS payer_vpa, payer_handle AS payer_handle, payee_bank AS payee_bank \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table\n) AS dataset_1133\ngroup by status,payer_bank, created_on \n) \n\nSELECT date(created_on) dt,\npayer_bank,\nsum(txns) total_Txn,\nsum(txns) filter(where status in('SUCCESS','DEEMED')) Success_txns,\nsum(txns) filter(where status in('FAILURE')) Failed_txns,\nsum(txns) filter(where status in('PENDING')) Pending_txns\nfrom A\nwhere payer_bank in (\nSELECT payer_bank payer_bank\nFROM\n(\nSELECT \"final_Category\" AS \"final_Category\", payee_handle AS payee_handle, payer_cust_id AS payer_cust_id, flow_cat AS flow_cat, payer_account_type AS payer_account_type, payer_bank AS payer_bank, created_on AS created_on, dt AS dt, date_time_hourly AS date_time_hourly, txn_id AS txn_id, amount AS amount, \"Error_code\" AS \"Error_code\", status AS status, payer_vpa AS payer_vpa, payer_handle AS payer_handle, payee_bank AS payee_bank \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table\n) AS dataset_1133\ngroup by payer_bank\norder by count(txn_id) desc\nLIMIT 10\n)\nGROUP by 1,2\n) AS virtual_table GROUP BY payer_bank, dt ORDER BY sum(\"total_Txn\") DESC\nLIMIT 1000;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_p9dviuymaa_qh6oziixy9",
          "sqlExpression": "(sum(Success_txns)*1.0000)/\n(SUM(total_Txn)*1.00000)"
        }
      ],
      "columns": [
        "dt",
        "payer_bank",
        "total_Txn",
        "Success_txns",
        "Failed_txns",
        "Pending_txns"
      ],
      "groupby_columns": [
        "dt"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "expressionType": "SIMPLE",
          "operator": "TEMPORAL_RANGE",
          "subject": "dt"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3935,
      "chart_name": "Top Error Codes (T-1 vs L7D Avg)",
      "chart_type": "table",
      "dataset_id": 1700,
      "dataset_name": "UPI SR Monitoring (T- & T-7)",
      "database_name": "Trino",
      "sql_query": "SELECT npci_resp_code AS npci_resp_code, COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday') AS \"Yesterday's Failure\", COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')/7 AS \"Last7day Failure\", (\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')*1.0000\n)\n/(\n\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')*1.0000/7\n)-1 AS \"Change Yday vs last 7 day avg\" \nFROM (select \ntxn_timestamp created_on\n,date(txn_timestamp) dt\n,txn_id\n,amount\n,coalesce(npci_resp_code,app_resp_code) npci_resp_code\n,status\n,flow_category\n,payer_handle\n,customer_id_payer payer_cust_id\n,payer_account_type payer_account_type\n,payer_bank_name\n,payee_bank_name\n,payee_handle\n,CASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_Category\n,case\nwhen date(txn_timestamp) = (current_date - interval '01' day) then 'Yday'\nwhen date(txn_timestamp) between (current_date - interval '08' day) and (current_date - interval '02' day) then 'last7day'\nend as period\n,case when status ='SUCCESS' then txn_id end as success_Txns\n\nFROM   hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >= (current_date - interval '08' day)\n  AND transaction_date_key   >= (current_date - interval '08' day)\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n  and purpose_code !='14'\n) AS virtual_table \nWHERE status = 'FAILURE' GROUP BY npci_resp_code ORDER BY \"Yesterday's Failure\" DESC\nLIMIT 20;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_v9ugyiw6od_p7p6nwya02q",
          "sqlExpression": "COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Last7day Failure",
          "optionName": "metric_litenfcj72l_05f50auh1unq",
          "sqlExpression": "COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')/7\n"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Change Yday vs last 7 day avg",
          "optionName": "metric_x5kfik8gaqf_k6j3jtpxhr",
          "sqlExpression": "(\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')*1.0000\n)\n/(\n\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')*1.0000/7\n)-1"
        }
      ],
      "columns": [
        "final_Category",
        "payer_handle",
        "period",
        "success_Txns",
        "payer_cust_id",
        "created_on",
        "dt",
        "txn_id",
        "amount",
        "npci_resp_code",
        "status",
        "flow_category",
        "payer_account_type",
        "payer_bank_name",
        "payee_bank_name",
        "payee_handle"
      ],
      "groupby_columns": [
        "npci_resp_code"
      ],
      "filters": [
        {
          "expressionType": "SIMPLE",
          "subject": "created_on",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_3y6xfypo66_1il6b5zadlx"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "status",
          "operator": "==",
          "operatorId": "EQUALS",
          "comparator": "FAILURE",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_d405omyo5fc_ckqcpjd6bto"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3940,
      "chart_name": "Top 5 Error Code & Bank (T-1 vs L7D)",
      "chart_type": "table",
      "dataset_id": 1742,
      "dataset_name": "Top 5 Error Code & Bank (T-1 vs L7D)",
      "database_name": "Trino",
      "sql_query": "SELECT payer_bank_name AS payer_bank_name, npci_resp_code AS npci_resp_code, sum(total_yest_failures) AS \"Yesterday's Failure\", sum(\"total_L7D_failures\") AS \"Last 7 Day avg\", (sum(total_yest_failures*1.0000)/sum(total_L7D_failures*1.000) -1)  AS \"% Change(Yest vs L7D Avg)\" \nFROM (WITH BankFailures AS (\n       SELECT\n              payer_bank_name payer_bank_name,\n              npci_resp_code as npci_resp_code,\n            \n              count(distinct case when date(created_on) = DATE_ADD('day', -1, CURRENT_DATE) then txn_id end) as yest_failures,\n              count(distinct case when date(created_on) between DATE_ADD('day', -8, CURRENT_DATE) and DATE_ADD('day', -2, CURRENT_DATE) then txn_id end)/7 as Last_7D_AVG_failures\n              from (\nSELECT \"final_Category\" AS \"final_Category\", payer_handle AS payer_handle, period AS period, \"success_Txns\" AS \"success_Txns\", payer_cust_id AS payer_cust_id, created_on AS created_on, dt AS dt, txn_id AS txn_id, amount AS amount, npci_resp_code AS npci_resp_code, status AS status, flow_category AS flow_category, payer_account_type AS payer_account_type, payer_bank_name AS payer_bank_name, payee_bank_name AS payee_bank_name, payee_handle AS payee_handle \nFROM (select \ntxn_timestamp created_on\n,date(txn_timestamp) dt\n,txn_id\n,amount\n,coalesce(npci_resp_code,app_resp_code) npci_resp_code\n,status\n,flow_category\n,payer_handle\n,customer_id_payer payer_cust_id\n,payer_account_type payer_account_type\n,payer_bank_name\n,payee_bank_name\n,payee_handle\n,CASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_Category\n,case\nwhen date(txn_timestamp) = (current_date - interval '01' day) then 'Yday'\nwhen date(txn_timestamp) between (current_date - interval '08' day) and (current_date - interval '02' day) then 'last7day'\nend as period\n,case when status ='SUCCESS' then txn_id end as success_Txns\n\nFROM   hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >= (current_date - interval '08' day)\n  AND transaction_date_key   >= (current_date - interval '08' day)\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n  and purpose_code !='14'\n) AS virtual_table\n) AS dataset_1700 \n             where  lower(status) in('failure')\n             and npci_resp_code is not null\n          GROUP BY 1, 2\n      ),\n      TopBanks AS (\n          SELECT payer_bank_name\n          FROM (\n              SELECT payer_bank_name,\n                  ROW_NUMBER() OVER (ORDER BY SUM(yest_failures) DESC, SUM(Last_7D_AVG_failures) DESC) AS rn\n              FROM BankFailures\n              GROUP BY payer_bank_name\n          ) ranked\n          WHERE rn <= 5\n      ),\n      TopBankCodes AS (\n          SELECT payer_bank_name, npci_resp_code\n          FROM (\n              SELECT payer_bank_name, npci_resp_code,\n                  ROW_NUMBER() OVER (PARTITION BY payer_bank_name ORDER BY yest_failures DESC, Last_7D_AVG_failures DESC) AS rn\n              FROM BankFailures\n          ) ranked\n          WHERE rn <= 5\n      )\n      SELECT\n          tbc.payer_bank_name,\n          tbc.npci_resp_code,\n          SUM(bf.Last_7D_AVG_failures) AS total_L7D_failures,\n          SUM(bf.yest_failures) AS total_yest_failures\n      FROM BankFailures bf\n      JOIN TopBanks tb ON bf.payer_bank_name = tb.payer_bank_name\n      JOIN TopBankCodes tbc ON bf.payer_bank_name = tbc.payer_bank_name\n          AND (bf.npci_resp_code = tbc.npci_resp_code OR (bf.npci_resp_code IS NULL AND tbc.npci_resp_code IS NULL))\n      GROUP BY tbc.payer_bank_name, tbc.npci_resp_code\n      ORDER BY total_yest_failures DESC, total_L7D_failures DESC\n) AS virtual_table GROUP BY payer_bank_name, npci_resp_code ORDER BY \"Yesterday's Failure\" DESC\nLIMIT 1000;\n\n",
      "metrics": [
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "total_yest_failures",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 36750,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_v9ugyiw6od_p7p6nwya02q"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "total_L7D_failures",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 36749,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Last 7 Day avg",
          "optionName": "metric_uozedv0pgi_5q9lj24nimj"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "(sum(total_yest_failures*1.0000)/sum(total_L7D_failures*1.000) -1) ",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "% Change(Yest vs L7D Avg)",
          "optionName": "metric_ooo1v49lxsb_kmn9d3e35w8"
        }
      ],
      "columns": [
        "payer_bank_name",
        "npci_resp_code",
        "total_L7D_failures",
        "total_yest_failures"
      ],
      "groupby_columns": [
        "payer_bank_name",
        "npci_resp_code"
      ],
      "filters": [],
      "time_range": null
    },
    {
      "chart_id": 3980,
      "chart_name": "Top 5 Error Code & Payer Handle (T-1 vs L7D Avg) : Exc (U30-Z9 & U30-ZM)",
      "chart_type": "table",
      "dataset_id": 1745,
      "dataset_name": "Top 5 Error Code & Payer Handle (T-1 vs L7D Avg) : Exc (U30-Z9 & U30-ZM)",
      "database_name": "Trino",
      "sql_query": "SELECT payer_handle AS payer_handle, npci_resp_code AS npci_resp_code, sum(total_yest_failures) AS \"Yesterday's Failure\", sum(\"total_L7D_failures\") AS \"Last 7 Day avg\", (sum(total_yest_failures*1.0000)/sum(total_L7D_failures*1.000) -1)  AS \"% Change(Yest vs L7D Avg)\" \nFROM (WITH BankFailures AS (\n          SELECT\n              payer_handle payer_handle,\n              npci_resp_code as npci_resp_code,\n              count(distinct case when date(created_on) = DATE_ADD('day', -1, CURRENT_DATE) then txn_id end) as yest_failures,\n              count(distinct case when date(created_on) between DATE_ADD('day', -8, CURRENT_DATE) and DATE_ADD('day', -2, CURRENT_DATE) then txn_id end)/7 as Last_7D_AVG_failures\n              from (\nSELECT \"final_Category\" AS \"final_Category\", payer_handle AS payer_handle, period AS period, \"success_Txns\" AS \"success_Txns\", payer_cust_id AS payer_cust_id, created_on AS created_on, dt AS dt, txn_id AS txn_id, amount AS amount, npci_resp_code AS npci_resp_code, status AS status, flow_category AS flow_category, payer_account_type AS payer_account_type, payer_bank_name AS payer_bank_name, payee_bank_name AS payee_bank_name, payee_handle AS payee_handle \nFROM (select \ntxn_timestamp created_on\n,date(txn_timestamp) dt\n,txn_id\n,amount\n,coalesce(npci_resp_code,app_resp_code) npci_resp_code\n,status\n,flow_category\n,payer_handle\n,customer_id_payer payer_cust_id\n,payer_account_type payer_account_type\n,payer_bank_name\n,payee_bank_name\n,payee_handle\n,CASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_Category\n,case\nwhen date(txn_timestamp) = (current_date - interval '01' day) then 'Yday'\nwhen date(txn_timestamp) between (current_date - interval '08' day) and (current_date - interval '02' day) then 'last7day'\nend as period\n,case when status ='SUCCESS' then txn_id end as success_Txns\n\nFROM   hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >= (current_date - interval '08' day)\n  AND transaction_date_key   >= (current_date - interval '08' day)\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n  and purpose_code !='14'\n) AS virtual_table\n) AS dataset_1700 \n             where  lower(status) in('failure')\n             and npci_resp_code is not null\n             and upper(npci_resp_code) not in('U30-Z9','U30-ZM')\n          GROUP BY 1, 2\n          \n      ),\n      TopBanks AS (\n          SELECT payer_handle\n          FROM (\n              SELECT payer_handle,\n                  ROW_NUMBER() OVER (ORDER BY SUM(yest_failures) DESC, SUM(Last_7D_AVG_failures) DESC) AS rn\n              FROM BankFailures\n              GROUP BY payer_handle\n          ) ranked\n          WHERE rn <= 5\n      ),\n      TopBankCodes AS (\n          SELECT payer_handle, npci_resp_code\n          FROM (\n              SELECT payer_handle, npci_resp_code,\n                  ROW_NUMBER() OVER (PARTITION BY payer_handle ORDER BY yest_failures DESC, Last_7D_AVG_failures DESC) AS rn\n              FROM BankFailures\n          ) ranked\n          WHERE rn <= 5\n      )\n      SELECT\n          tbc.payer_handle,\n          tbc.npci_resp_code,\n          SUM(bf.Last_7D_AVG_failures) AS total_L7D_failures,\n          SUM(bf.yest_failures) AS total_yest_failures\n      FROM BankFailures bf\n      JOIN TopBanks tb ON bf.payer_handle = tb.payer_handle\n      JOIN TopBankCodes tbc ON bf.payer_handle = tbc.payer_handle\n          AND (bf.npci_resp_code = tbc.npci_resp_code OR (bf.npci_resp_code IS NULL AND tbc.npci_resp_code IS NULL))\n      GROUP BY tbc.payer_handle, tbc.npci_resp_code\n      ORDER BY total_yest_failures DESC, total_L7D_failures DESC\n) AS virtual_table GROUP BY payer_handle, npci_resp_code ORDER BY \"Yesterday's Failure\" DESC\nLIMIT 1000;\n\n",
      "metrics": [
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "total_yest_failures",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 36919,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_v9ugyiw6od_p7p6nwya02q"
        },
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "total_L7D_failures",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 36918,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Last 7 Day avg",
          "optionName": "metric_uozedv0pgi_5q9lj24nimj"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "(sum(total_yest_failures*1.0000)/sum(total_L7D_failures*1.000) -1) ",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "% Change(Yest vs L7D Avg)",
          "optionName": "metric_ooo1v49lxsb_kmn9d3e35w8"
        }
      ],
      "columns": [
        "payer_handle",
        "npci_resp_code",
        "total_L7D_failures",
        "total_yest_failures"
      ],
      "groupby_columns": [
        "payer_handle",
        "npci_resp_code"
      ],
      "filters": [],
      "time_range": null
    },
    {
      "chart_id": 3987,
      "chart_name": "Top 5 Error Code & Payee Handle (T-1 vs L7D Avg) : Exc (U30-Z9 & U30-ZM)",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1749,
      "dataset_name": "Top 5 Error Code & Payee Handle (T-1 vs L7D Avg) : Exc (U30-Z9 & U30-ZM)",
      "database_name": "Trino",
      "sql_query": "SELECT payee_handle AS payee_handle, npci_resp_code AS npci_resp_code, sum(total_yest_failures) AS \"Yesterday's Failure\", sum(\"total_L7D_failures\") AS \"Last 7 Day avg\", (sum(total_yest_failures*1.0000)/sum(total_L7D_failures*1.000) -1) *100 AS \"% Change(Yest vs L7D Avg)\" \nFROM (WITH payee_handle_Failures AS (\n          SELECT\n              payee_handle payee_handle,\n              npci_resp_code as npci_resp_code,\n              count(distinct case when date(created_on) = DATE_ADD('day', -1, CURRENT_DATE) then txn_id end) as yest_failures,\n              count(distinct case when date(created_on) between DATE_ADD('day', -8, CURRENT_DATE) and DATE_ADD('day', -2, CURRENT_DATE) then txn_id end)/7 as Last_7D_AVG_failures\n              from (\nSELECT \"final_Category\" AS \"final_Category\", payer_handle AS payer_handle, period AS period, \"success_Txns\" AS \"success_Txns\", payer_cust_id AS payer_cust_id, created_on AS created_on, dt AS dt, txn_id AS txn_id, amount AS amount, npci_resp_code AS npci_resp_code, status AS status, flow_category AS flow_category, payer_account_type AS payer_account_type, payer_bank_name AS payer_bank_name, payee_bank_name AS payee_bank_name, payee_handle AS payee_handle \nFROM (select \ntxn_timestamp created_on\n,date(txn_timestamp) dt\n,txn_id\n,amount\n,coalesce(npci_resp_code,app_resp_code) npci_resp_code\n,status\n,flow_category\n,payer_handle\n,customer_id_payer payer_cust_id\n,payer_account_type payer_account_type\n,payer_bank_name\n,payee_bank_name\n,payee_handle\n,CASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_Category\n,case\nwhen date(txn_timestamp) = (current_date - interval '01' day) then 'Yday'\nwhen date(txn_timestamp) between (current_date - interval '08' day) and (current_date - interval '02' day) then 'last7day'\nend as period\n,case when status ='SUCCESS' then txn_id end as success_Txns\n\nFROM   hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >= (current_date - interval '08' day)\n  AND transaction_date_key   >= (current_date - interval '08' day)\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n  and purpose_code !='14'\n) AS virtual_table\n) AS dataset_1700 \n             where  lower(status) in('failure')\n             and npci_resp_code is not null\n             and upper(npci_resp_code) not in('U30-Z9','U30-ZM')\n          GROUP BY 1, 2\n          \n      ),\n      TopBanks AS (\n          SELECT payee_handle\n          FROM (\n              SELECT payee_handle,\n                  ROW_NUMBER() OVER (ORDER BY SUM(yest_failures) DESC, SUM(Last_7D_AVG_failures) DESC) AS rn\n              FROM payee_handle_Failures where payee_handle is not null\n              GROUP BY payee_handle\n          ) ranked\n          WHERE rn <= 5\n      )\n      \n      ,\n      TopBankCodes AS (\n          SELECT payee_handle, npci_resp_code\n          FROM (\n              SELECT payee_handle, npci_resp_code,\n                  ROW_NUMBER() OVER (PARTITION BY payee_handle ORDER BY yest_failures DESC, Last_7D_AVG_failures DESC) AS rn\n              FROM payee_handle_Failures where payee_handle is not null\n              and payee_handle in( SELECT payee_handle from TopBanks)\n          ) ranked\n          WHERE rn <= 5\n      )\n      \n      SELECT\n          tbc.payee_handle,\n          tbc.npci_resp_code,\n          SUM(bf.Last_7D_AVG_failures) AS total_L7D_failures,\n          SUM(bf.yest_failures) AS total_yest_failures\n      FROM payee_handle_Failures bf\n      JOIN TopBanks tb ON bf.payee_handle = tb.payee_handle\n      JOIN TopBankCodes tbc ON bf.payee_handle = tbc.payee_handle\n          AND (bf.npci_resp_code = tbc.npci_resp_code OR (bf.npci_resp_code IS NULL AND tbc.npci_resp_code IS NULL))\n      GROUP BY tbc.payee_handle, tbc.npci_resp_code\n      ORDER BY total_yest_failures DESC, total_L7D_failures DESC\n) AS virtual_table GROUP BY payee_handle, npci_resp_code ORDER BY \"Yesterday's Failure\" DESC\nLIMIT 1000;\n\n",
      "metrics": [
        {
          "aggregate": "SUM",
          "column": {
            "advanced_data_type": null,
            "changed_on": "2025-10-12T08:22:21.764160",
            "column_name": "total_yest_failures",
            "created_on": "2025-10-12T08:22:21.764158",
            "description": null,
            "expression": null,
            "extra": null,
            "filterable": true,
            "groupby": true,
            "id": 36750,
            "is_active": true,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "uuid": "251a7c1b-8918-471e-86eb-d7a015502e3c",
            "verbose_name": null
          },
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_v9ugyiw6od_p7p6nwya02q",
          "sqlExpression": null
        },
        {
          "aggregate": "SUM",
          "column": {
            "advanced_data_type": null,
            "changed_on": "2025-10-12T08:22:21.764120",
            "column_name": "total_L7D_failures",
            "created_on": "2025-10-12T08:22:21.764118",
            "description": null,
            "expression": null,
            "extra": null,
            "filterable": true,
            "groupby": true,
            "id": 36749,
            "is_active": true,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "uuid": "523e2c8b-1e00-49b3-99b6-bcd357dbcf9b",
            "verbose_name": null
          },
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "hasCustomLabel": true,
          "label": "Last 7 Day avg",
          "optionName": "metric_uozedv0pgi_5q9lj24nimj",
          "sqlExpression": null
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "% Change(Yest vs L7D Avg)",
          "optionName": "metric_ooo1v49lxsb_kmn9d3e35w8",
          "sqlExpression": "(sum(total_yest_failures*1.0000)/sum(total_L7D_failures*1.000) -1) *100"
        }
      ],
      "columns": [
        "total_yest_failures",
        "payee_handle",
        "npci_resp_code",
        "total_L7D_failures"
      ],
      "groupby_columns": [],
      "filters": [],
      "time_range": null
    },
    {
      "chart_id": 3988,
      "chart_name": "All Bank (T-1 vs L7D)",
      "chart_type": "table",
      "dataset_id": 1700,
      "dataset_name": "UPI SR Monitoring (T- & T-7)",
      "database_name": "Trino",
      "sql_query": "SELECT payer_bank_name AS payer_bank_name, COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday') AS \"Yesterday's Failure\", COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')/7 AS \"Last7day Failure\", (\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')*1.0000\n)\n/(\n\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')*1.0000/7\n)-1 AS \"Change Yday vs last 7 day avg\" \nFROM (select \ntxn_timestamp created_on\n,date(txn_timestamp) dt\n,txn_id\n,amount\n,coalesce(npci_resp_code,app_resp_code) npci_resp_code\n,status\n,flow_category\n,payer_handle\n,customer_id_payer payer_cust_id\n,payer_account_type payer_account_type\n,payer_bank_name\n,payee_bank_name\n,payee_handle\n,CASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_Category\n,case\nwhen date(txn_timestamp) = (current_date - interval '01' day) then 'Yday'\nwhen date(txn_timestamp) between (current_date - interval '08' day) and (current_date - interval '02' day) then 'last7day'\nend as period\n,case when status ='SUCCESS' then txn_id end as success_Txns\n\nFROM   hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >= (current_date - interval '08' day)\n  AND transaction_date_key   >= (current_date - interval '08' day)\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n  and purpose_code !='14'\n) AS virtual_table \nWHERE status = 'FAILURE' GROUP BY payer_bank_name ORDER BY \"Yesterday's Failure\" DESC\nLIMIT 20;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_v9ugyiw6od_p7p6nwya02q",
          "sqlExpression": "COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Last7day Failure",
          "optionName": "metric_litenfcj72l_05f50auh1unq",
          "sqlExpression": "COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')/7\n"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Change Yday vs last 7 day avg",
          "optionName": "metric_x5kfik8gaqf_k6j3jtpxhr",
          "sqlExpression": "(\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')*1.0000\n)\n/(\n\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')*1.0000/7\n)-1"
        }
      ],
      "columns": [
        "final_Category",
        "payer_handle",
        "period",
        "success_Txns",
        "payer_cust_id",
        "created_on",
        "dt",
        "txn_id",
        "amount",
        "npci_resp_code",
        "status",
        "flow_category",
        "payer_account_type",
        "payer_bank_name",
        "payee_bank_name",
        "payee_handle"
      ],
      "groupby_columns": [
        "payer_bank_name"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_3y6xfypo66_1il6b5zadlx",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "created_on"
        },
        {
          "clause": "WHERE",
          "comparator": "FAILURE",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_d405omyo5fc_ckqcpjd6bto",
          "isExtra": false,
          "isNew": false,
          "operator": "==",
          "operatorId": "EQUALS",
          "sqlExpression": null,
          "subject": "status"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3989,
      "chart_name": "Error Code & Bank All Data (T-1 vs L7D Avg)",
      "chart_type": "table",
      "dataset_id": 1700,
      "dataset_name": "UPI SR Monitoring (T- & T-7)",
      "database_name": "Trino",
      "sql_query": "SELECT npci_resp_code AS npci_resp_code, payer_bank_name AS payer_bank_name, COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday') AS \"Yesterday's Failure\", COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')/7 AS \"Last7day Failure\", (\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')*1.0000\n)\n/(\n\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')*1.0000/7\n)-1 AS \"Change Yday vs last 7 day avg\" \nFROM (select \ntxn_timestamp created_on\n,date(txn_timestamp) dt\n,txn_id\n,amount\n,coalesce(npci_resp_code,app_resp_code) npci_resp_code\n,status\n,flow_category\n,payer_handle\n,customer_id_payer payer_cust_id\n,payer_account_type payer_account_type\n,payer_bank_name\n,payee_bank_name\n,payee_handle\n,CASE                        \n        WHEN flow_category IN ('P2P') THEN 'P2P'\n        WHEN flow_category IN ('3P QR', 'Paytm QR') THEN 'SnP'\n        WHEN flow_category IN ('Intent', 'P2M Collect','Mandate_Online') THEN 'Online'\n        WHEN flow_category IN ('Onus_ExcMandates','Mandate_Onus') THEN 'Onus'\n        ELSE 'Others' \nEND AS final_Category\n,case\nwhen date(txn_timestamp) = (current_date - interval '01' day) then 'Yday'\nwhen date(txn_timestamp) between (current_date - interval '08' day) and (current_date - interval '02' day) then 'last7day'\nend as period\n,case when status ='SUCCESS' then txn_id end as success_Txns\n\nFROM   hive.cdo.fact_upi_transactions_snapshot_v3\nWHERE dl_last_updated >= (current_date - interval '08' day)\n  AND transaction_date_key   >= (current_date - interval '08' day)\n  AND transaction_type IN ('PAY','COLLECT')\n  AND lower(payer_handle) IN ('paytm','ptyes','ptaxis','pthdfc','ptsbi')\n  and category in ('VPA2ACCOUNT','VPA2VPA','VPA2MERCHANT')\n  and purpose_code !='14'\n) AS virtual_table \nWHERE status = 'FAILURE' GROUP BY npci_resp_code, payer_bank_name ORDER BY \"Yesterday's Failure\" DESC\nLIMIT 100;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Yesterday's Failure",
          "optionName": "metric_v9ugyiw6od_p7p6nwya02q",
          "sqlExpression": "COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Last7day Failure",
          "optionName": "metric_litenfcj72l_05f50auh1unq",
          "sqlExpression": "COUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')/7\n"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Change Yday vs last 7 day avg",
          "optionName": "metric_x5kfik8gaqf_k6j3jtpxhr",
          "sqlExpression": "(\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'Yday')*1.0000\n)\n/(\n\nCOUNT(txn_id) filter(WHERE status = 'FAILURE' and period = 'last7day')*1.0000/7\n)-1"
        }
      ],
      "columns": [
        "final_Category",
        "payer_handle",
        "period",
        "success_Txns",
        "payer_cust_id",
        "created_on",
        "dt",
        "txn_id",
        "amount",
        "npci_resp_code",
        "status",
        "flow_category",
        "payer_account_type",
        "payer_bank_name",
        "payee_bank_name",
        "payee_handle"
      ],
      "groupby_columns": [
        "npci_resp_code",
        "payer_bank_name"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_3y6xfypo66_1il6b5zadlx",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "created_on"
        },
        {
          "clause": "WHERE",
          "comparator": "FAILURE",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_d405omyo5fc_ckqcpjd6bto",
          "isExtra": false,
          "isNew": false,
          "operator": "==",
          "operatorId": "EQUALS",
          "sqlExpression": null,
          "subject": "status"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3990,
      "chart_name": "Hourly SR Trend By Category (T vs T-1)- 588",
      "chart_type": "echarts_timeseries_line",
      "dataset_id": 1133,
      "dataset_name": "UPI SR Monitoring (T & T-1)",
      "database_name": "Trino",
      "sql_query": "SELECT date_trunc('hour',created_on) AS \"Time_\", \"final_Category\" AS \"final_Category\", (COUNT(txn_id) filter(WHERE status = 'SUCCESS')*1.0000) / (COUNT(txn_id)*1.0000) AS \"SR\" \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table \nWHERE dt >= DATE '2025-11-22' AND dt < DATE '2025-11-23' AND flow_cat != 'Other P2M' GROUP BY date_trunc('hour',created_on), \"final_Category\" ORDER BY \"SR\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_1pqt874jw2y_8i05n1gotmg",
          "sqlExpression": "(COUNT(txn_id) filter(WHERE status = 'SUCCESS')*1.0000) / (COUNT(txn_id)*1.0000)"
        }
      ],
      "columns": [
        "final_Category",
        "payee_handle",
        "payer_cust_id",
        "flow_cat",
        "payer_account_type",
        "payer_bank",
        "created_on",
        "dt",
        "date_time_hourly",
        "txn_id",
        "amount",
        "Error_code",
        "status",
        "payer_vpa",
        "payer_handle",
        "payee_bank"
      ],
      "groupby_columns": [
        "final_Category"
      ],
      "filters": [
        {
          "expressionType": "SIMPLE",
          "subject": "created_on",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_2r5z28cm02a_gpwrnaesgq"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "date_time_hourly",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_re4osa50yzh_b7mas0z1syi"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "dt",
          "operator": "TEMPORAL_RANGE",
          "operatorId": "TEMPORAL_RANGE",
          "comparator": "Current day",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_xm0gu72dupb_3gahvu27jen"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "flow_cat",
          "operator": "!=",
          "operatorId": "NOT_EQUALS",
          "comparator": "Other P2M",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_dj1qllc8ido_v8iwmcwqli"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3992,
      "chart_name": "Paytm to Competition Overall SR (T & T-1)",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1754,
      "dataset_name": "T_vs_T1_Paytm_N_Competition_SR",
      "database_name": "Trino",
      "sql_query": "SELECT date_trunc('day', CAST(dt AS TIMESTAMP)) AS dt, hr AS hr, payee_ AS payee_, sum(txns) AS \"Total Txn\", sum(txns)filter(where status in('SUCCESS','DEEMED')) AS \"Success Txns\", ((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100 AS \"SR\", (((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payee_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n) AS \"% Change SR\" \nFROM (select\n      dt,\n      hr,\n      mandate_flag,\n      category,\n      status,\n      resp_code,\n      QR_FLAG,\n      payee_,\n      payer_,\n      response_constant,\n      coalesce(txns,0) as txns\n      from user_paytm_payments.T_vs_T1_Paytm_N_Competition_SR\n) AS virtual_table \nWHERE payer_ = 'Paytm' GROUP BY date_trunc('day', CAST(dt AS TIMESTAMP)), hr, payee_ ORDER BY \"Total Txn\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "aggregate": "SUM",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "txns",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 37069,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "hasCustomLabel": true,
          "label": "Total Txn",
          "optionName": "metric_1uu4d4el5j2_3js8umatawh",
          "sqlExpression": null
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Success Txns",
          "optionName": "metric_ox596sp5zmq_vte7rvvoh6",
          "sqlExpression": "sum(txns)filter(where status in('SUCCESS','DEEMED'))"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_p9akradazzj_nw9pg691pef",
          "sqlExpression": "((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "% Change SR",
          "optionName": "metric_tzpkkbud5g_h9wr81fn7p",
          "sqlExpression": "(((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payee_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n)"
        }
      ],
      "columns": [
        "dt",
        "hr",
        "mandate_flag",
        "category",
        "status",
        "resp_code",
        "QR_FLAG",
        "payee_",
        "payer_",
        "response_constant",
        "txns"
      ],
      "groupby_columns": [],
      "filters": [
        {
          "expressionType": "SIMPLE",
          "subject": "dt",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_5jsoluznfv4_zaejrmbx16j"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "payer_",
          "operator": "==",
          "operatorId": "EQUALS",
          "comparator": "Paytm",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_vab2b2et1x_zoc2lzglxvg"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3995,
      "chart_name": "Paytm to Competition P2P SR (T & T-1)",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1754,
      "dataset_name": "T_vs_T1_Paytm_N_Competition_SR",
      "database_name": "Trino",
      "sql_query": "SELECT date_trunc('day', CAST(dt AS TIMESTAMP)) AS dt, hr AS hr, payee_ AS payee_, sum(txns) AS \"Total Txn\", sum(txns)filter(where status in('SUCCESS','DEEMED')) AS \"Success Txns\", ((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100 AS \"SR\", (((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payee_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n) AS \"% Change SR\" \nFROM (select\n      dt,\n      hr,\n      mandate_flag,\n      category,\n      status,\n      resp_code,\n      QR_FLAG,\n      payee_,\n      payer_,\n      response_constant,\n      coalesce(txns,0) as txns\n      from user_paytm_payments.T_vs_T1_Paytm_N_Competition_SR\n) AS virtual_table \nWHERE payer_ = 'Paytm' AND category IN ('VPA2VPA', 'VPA2ACCOUNT') GROUP BY date_trunc('day', CAST(dt AS TIMESTAMP)), hr, payee_ ORDER BY \"Total Txn\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "aggregate": "SUM",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "txns",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 37069,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "hasCustomLabel": true,
          "label": "Total Txn",
          "optionName": "metric_1uu4d4el5j2_3js8umatawh",
          "sqlExpression": null
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Success Txns",
          "optionName": "metric_ox596sp5zmq_vte7rvvoh6",
          "sqlExpression": "sum(txns)filter(where status in('SUCCESS','DEEMED'))"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_p9akradazzj_nw9pg691pef",
          "sqlExpression": "((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "% Change SR",
          "optionName": "metric_tzpkkbud5g_h9wr81fn7p",
          "sqlExpression": "(((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payee_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n)"
        }
      ],
      "columns": [
        "dt",
        "hr",
        "mandate_flag",
        "category",
        "status",
        "resp_code",
        "QR_FLAG",
        "payee_",
        "payer_",
        "response_constant",
        "txns"
      ],
      "groupby_columns": [],
      "filters": [
        {
          "expressionType": "SIMPLE",
          "subject": "dt",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_5jsoluznfv4_zaejrmbx16j"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "payer_",
          "operator": "==",
          "operatorId": "EQUALS",
          "comparator": "Paytm",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_vab2b2et1x_zoc2lzglxvg"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "category",
          "operator": "IN",
          "operatorId": "IN",
          "comparator": [
            "VPA2VPA",
            "VPA2ACCOUNT"
          ],
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_78eh5foii3c_mzx99b0orn"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3996,
      "chart_name": "Competition to Paytm P2P SR (T & T-1)",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1754,
      "dataset_name": "T_vs_T1_Paytm_N_Competition_SR",
      "database_name": "Trino",
      "sql_query": "SELECT date_trunc('day', CAST(dt AS TIMESTAMP)) AS dt, hr AS hr, payer_ AS payer_, sum(txns) AS \"Total Txn\", sum(txns)filter(where status in('SUCCESS','DEEMED')) AS \"Success Txns\", ((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100 AS \"SR\", (((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payer_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n) AS \"% Change SR\" \nFROM (select\n      dt,\n      hr,\n      mandate_flag,\n      category,\n      status,\n      resp_code,\n      QR_FLAG,\n      payee_,\n      payer_,\n      response_constant,\n      coalesce(txns,0) as txns\n      from user_paytm_payments.T_vs_T1_Paytm_N_Competition_SR\n) AS virtual_table \nWHERE payer_ != 'Paytm' AND category IN ('VPA2VPA', 'VPA2ACCOUNT') GROUP BY date_trunc('day', CAST(dt AS TIMESTAMP)), hr, payer_ ORDER BY \"Total Txn\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "txns",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 37069,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Total Txn",
          "optionName": "metric_1uu4d4el5j2_3js8umatawh"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "sum(txns)filter(where status in('SUCCESS','DEEMED'))",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Success Txns",
          "optionName": "metric_ox596sp5zmq_vte7rvvoh6"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_p9akradazzj_nw9pg691pef"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "(((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payer_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n)",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "% Change SR",
          "optionName": "metric_tzpkkbud5g_h9wr81fn7p"
        }
      ],
      "columns": [
        "dt",
        "hr",
        "mandate_flag",
        "category",
        "status",
        "resp_code",
        "QR_FLAG",
        "payee_",
        "payer_",
        "response_constant",
        "txns"
      ],
      "groupby_columns": [],
      "filters": [
        {
          "expressionType": "SIMPLE",
          "subject": "dt",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_5jsoluznfv4_zaejrmbx16j"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "payer_",
          "operator": "!=",
          "operatorId": "NOT_EQUALS",
          "comparator": "Paytm",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_vab2b2et1x_zoc2lzglxvg"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "category",
          "operator": "IN",
          "operatorId": "IN",
          "comparator": [
            "VPA2VPA",
            "VPA2ACCOUNT"
          ],
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_78eh5foii3c_mzx99b0orn"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3997,
      "chart_name": "Paytm to Competition QR SR (T & T-1)",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1754,
      "dataset_name": "T_vs_T1_Paytm_N_Competition_SR",
      "database_name": "Trino",
      "sql_query": "SELECT date_trunc('day', CAST(dt AS TIMESTAMP)) AS dt, hr AS hr, payee_ AS payee_, sum(txns) AS \"Total Txn\", sum(txns)filter(where status in('SUCCESS','DEEMED')) AS \"Success Txns\", ((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100 AS \"SR\", (((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payee_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n) AS \"% Change SR\" \nFROM (select\n      dt,\n      hr,\n      mandate_flag,\n      category,\n      status,\n      resp_code,\n      QR_FLAG,\n      payee_,\n      payer_,\n      response_constant,\n      coalesce(txns,0) as txns\n      from user_paytm_payments.T_vs_T1_Paytm_N_Competition_SR\n) AS virtual_table \nWHERE payer_ = 'Paytm' AND \"QR_FLAG\" IN ('3P QR', 'Paytm QR') GROUP BY date_trunc('day', CAST(dt AS TIMESTAMP)), hr, payee_ ORDER BY \"Total Txn\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "aggregate": "SUM",
          "column": {
            "advanced_data_type": null,
            "certification_details": null,
            "certified_by": null,
            "column_name": "txns",
            "description": null,
            "expression": null,
            "filterable": true,
            "groupby": true,
            "id": 37069,
            "is_certified": false,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "verbose_name": null,
            "warning_markdown": null
          },
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "hasCustomLabel": true,
          "label": "Total Txn",
          "optionName": "metric_1uu4d4el5j2_3js8umatawh",
          "sqlExpression": null
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "Success Txns",
          "optionName": "metric_ox596sp5zmq_vte7rvvoh6",
          "sqlExpression": "sum(txns)filter(where status in('SUCCESS','DEEMED'))"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_p9akradazzj_nw9pg691pef",
          "sqlExpression": "((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100"
        },
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "% Change SR",
          "optionName": "metric_tzpkkbud5g_h9wr81fn7p",
          "sqlExpression": "(((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100)\n-\n(\nlag(\n((\nsum(txns)filter(where status in('SUCCESS','DEEMED'))*1.0000\n)/(\nsum(txns)*1.0000)\n)*100\n) over(\npartition by hr, payee_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n)"
        }
      ],
      "columns": [
        "dt",
        "hr",
        "mandate_flag",
        "category",
        "status",
        "resp_code",
        "QR_FLAG",
        "payee_",
        "payer_",
        "response_constant",
        "txns"
      ],
      "groupby_columns": [],
      "filters": [
        {
          "expressionType": "SIMPLE",
          "subject": "dt",
          "operator": "TEMPORAL_RANGE",
          "comparator": "No filter",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_5jsoluznfv4_zaejrmbx16j"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "payer_",
          "operator": "==",
          "operatorId": "EQUALS",
          "comparator": "Paytm",
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_vab2b2et1x_zoc2lzglxvg"
        },
        {
          "expressionType": "SIMPLE",
          "subject": "QR_FLAG",
          "operator": "IN",
          "operatorId": "IN",
          "comparator": [
            "3P QR",
            "Paytm QR"
          ],
          "clause": "WHERE",
          "sqlExpression": null,
          "isExtra": false,
          "isNew": false,
          "datasourceWarning": false,
          "filterOptionName": "filter_o8k2kosg4bl_ph629jfziz"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 3998,
      "chart_name": "Competition to Paytm QR SR (T & T-1)",
      "chart_type": "pivot_table_v2",
      "dataset_id": 1761,
      "dataset_name": "t1_vs_t2_competition_to_paytm_sr",
      "database_name": "Trino",
      "sql_query": "SELECT date_trunc('day', CAST(dt AS TIMESTAMP)) AS dt, hr AS hr, payer_ AS payer_, sum(\"Overall_txn\") AS \"Total Txn\", sum(success) AS \"Success Txns\", (\nsum(success) *1.0000\n)/(\nsum(Overall_txn)*1.0000)\n*100 AS \"SR\", ((\nsum(success) *1.0000\n)/(\nsum(Overall_txn)*1.0000)\n*100)\n-\n(\nlag(\n(\nsum(success) *1.0000\n)/(\nsum(Overall_txn)*1.0000)\n*100\n) over(\npartition by hr, payer_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n) AS \"% Change SR\" \nFROM (select\n      dt,\n      hr,\n      payer_,\n      Overall_txn,\n      success\n      from \n user_paytm_payments.t1_vs_t2_competition_to_paytm_sr\n) AS virtual_table \nWHERE payer_ = 'Paytm' GROUP BY date_trunc('day', CAST(dt AS TIMESTAMP)), hr, payer_ ORDER BY \"Total Txn\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "expressionType": "SIMPLE",
          "column": {
            "advanced_data_type": null,
            "changed_on": "2025-10-12T14:31:49.443020",
            "column_name": "Overall_txn",
            "created_on": "2025-10-12T14:31:49.443018",
            "description": null,
            "expression": null,
            "extra": null,
            "filterable": true,
            "groupby": true,
            "id": 37158,
            "is_active": true,
            "is_dttm": false,
            "python_date_format": null,
            "type": "BIGINT",
            "type_generic": 0,
            "uuid": "e3c87e5f-32b2-4f76-84f0-1e87439e0dd3",
            "verbose_name": null
          },
          "aggregate": "SUM",
          "sqlExpression": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Total Txn",
          "optionName": "metric_ni5kymqg0c_9nvk6dr040r"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "sum(success)",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "Success Txns",
          "optionName": "metric_ox596sp5zmq_vte7rvvoh6"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "(\nsum(success) *1.0000\n)/(\nsum(Overall_txn)*1.0000)\n*100",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_p9akradazzj_nw9pg691pef"
        },
        {
          "expressionType": "SQL",
          "sqlExpression": "((\nsum(success) *1.0000\n)/(\nsum(Overall_txn)*1.0000)\n*100)\n-\n(\nlag(\n(\nsum(success) *1.0000\n)/(\nsum(Overall_txn)*1.0000)\n*100\n) over(\npartition by hr, payer_ order by date_trunc('day', CAST(dt AS TIMESTAMP))\n)\n)",
          "column": null,
          "aggregate": null,
          "datasourceWarning": false,
          "hasCustomLabel": true,
          "label": "% Change SR",
          "optionName": "metric_tzpkkbud5g_h9wr81fn7p"
        }
      ],
      "columns": [
        "dt",
        "hr",
        "payer_",
        "Overall_txn",
        "success"
      ],
      "groupby_columns": [],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_5jsoluznfv4_zaejrmbx16j",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "dt"
        },
        {
          "clause": "WHERE",
          "comparator": "Paytm",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_vab2b2et1x_zoc2lzglxvg",
          "isExtra": false,
          "isNew": false,
          "operator": "==",
          "operatorId": "EQUALS",
          "sqlExpression": null,
          "subject": "payer_"
        }
      ],
      "time_range": null
    },
    {
      "chart_id": 4001,
      "chart_name": "Last Hour SR Overall Alert",
      "chart_type": "table",
      "dataset_id": 1763,
      "dataset_name": "Last Hour SR Overall",
      "database_name": "Trino",
      "sql_query": "SELECT hour AS hour, sr_current AS sr_current, sr_avg AS sr_avg, sr_difference AS sr_difference \nFROM (WITH current_sr AS (\n        SELECT\n          HOUR(CAST(txn_timestamp AS TIMESTAMP)) AS hour,\n          CAST(COUNT(DISTINCT CASE WHEN LOWER(status) IN ('success','deemed') THEN txn_id END) AS DOUBLE) /\n          CAST(COUNT(DISTINCT txn_id) AS DOUBLE) AS sr_current\n        FROM hive.upi_txn.upi_activities_data_snapshot_v3\n        WHERE type IN ('COLLECT','PAY')\n          AND TRY(LOWER(SPLIT(payer_vpa, '@')[2])) IN ('paytm','ptsbi','ptaxis','pthdfc','ptyes')\n          AND category IN ('VPA2MERCHANT','VPA2VPA','VPA2ACCOUNT')\n          AND dl_last_updated >= DATE_ADD('day', -1, CURRENT_DATE)\n          AND (\n          --  Normal case: Only include today's transactions\n          (HOUR(CURRENT_TIMESTAMP AT TIME ZONE 'Asia/Kolkata') > 0\n           AND DATE(cast(txn_timestamp as timestamp)) = CURRENT_DATE)\n\n          --  Special case for 12 AM: Include 11 PM transactions from yesterday\n          OR (HOUR(CURRENT_TIMESTAMP AT TIME ZONE 'Asia/Kolkata') = 0\n              AND DATE(cast(txn_timestamp as timestamp)) = DATE_ADD('day', -1, CURRENT_DATE))\n      )\n          AND HOUR(CAST(txn_timestamp AS TIMESTAMP)) =\n              CASE\n                  WHEN HOUR(CAST(DATE_FORMAT(current_timestamp AT TIME ZONE 'Asia/Kolkata',\n                  '%Y-%m-%d %H:%i:%s.%f Asia/Calcutta') AS TIMESTAMP)) = 0\n                  THEN 23\n                  ELSE HOUR(CAST(DATE_FORMAT(current_timestamp AT TIME ZONE 'Asia/Kolkata',\n                  '%Y-%m-%d %H:%i:%s.%f Asia/Calcutta') AS TIMESTAMP)) - 1\n              END\n          AND participant_type = 'PAYER'\n          AND (LOWER(businesstype) <> 'mandate' OR businesstype IS NULL)\n        GROUP BY 1\n      )\n\n\n      SELECT\n        cs.hour,\n        cs.sr_current,\n        sb.sr_avg,\n        cast(cs.sr_current as double)- cast(sb.sr_avg as double) AS sr_difference\n      FROM current_sr cs\n      LEFT JOIN user_paytm_payments.feb_hourly_sr_benchamrk sb\n      ON cs.hour = sb.hour\n) AS virtual_table\nLIMIT 1000;\n\n",
      "metrics": [],
      "columns": [
        "hour",
        "sr_current",
        "sr_avg",
        "sr_difference"
      ],
      "groupby_columns": [],
      "filters": [],
      "time_range": null
    },
    {
      "chart_id": 4002,
      "chart_name": "T vs T-1 Error Codes Alert",
      "chart_type": "table",
      "dataset_id": 1762,
      "dataset_name": "T vs T-1 Error Codes Alert",
      "database_name": "Trino",
      "sql_query": "SELECT error_code AS error_code, todays_txns AS todays_txns, yesterdays_txns AS yesterdays_txns, \"Failure_Growth\" AS \"Failure_Growth\" \nFROM (with A as(\nSELECT   error_code error_code, \ndate(created_on) day_id,\ncount(txn_id) txns\nFROM (\nSELECT \"final_Category\" AS \"final_Category\", payee_handle AS payee_handle, payer_cust_id AS payer_cust_id, flow_cat AS flow_cat, payer_account_type AS payer_account_type, payer_bank AS payer_bank, created_on AS created_on, dt AS dt, date_time_hourly AS date_time_hourly, txn_id AS txn_id, amount AS amount, \"Error_code\" AS \"Error_code\", status AS status, payer_vpa AS payer_vpa, payer_handle AS payer_handle, payee_bank AS payee_bank \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table\n) AS dataset_1133\ngroup by error_code, created_on \n) \n\n\nselect error_code,todays_txns,yesterdays_txns, ((todays_txns*1.0000)/(yesterdays_txns*1.0000)-1) Failure_Growth\nfrom (\nselect \nerror_code\n,sum(txns) filter(WHERE day_id  = current_Date) todays_txns\n,sum(txns) filter(WHERE day_id  = current_Date - interval '01' day) yesterdays_txns\nfrom A\nWHERE error_code is not null\ngroup by 1 \nhaving sum(txns) filter(WHERE day_id  = current_Date)>5000\n)\n) AS virtual_table ORDER BY todays_txns DESC\nLIMIT 1000;\n\n",
      "metrics": [],
      "columns": [
        "error_code",
        "todays_txns",
        "yesterdays_txns",
        "Failure_Growth"
      ],
      "groupby_columns": [],
      "filters": [],
      "time_range": null
    },
    {
      "chart_id": 4382,
      "chart_name": "CC 0n UPI Hourly SR Trend (T vs T-1)- 588",
      "chart_type": "echarts_timeseries_line",
      "dataset_id": 1133,
      "dataset_name": "UPI SR Monitoring (T & T-1)",
      "database_name": "Trino",
      "sql_query": "SELECT hour(created_on) AS \"Hour\", dt AS dt, (COUNT(txn_id) filter(WHERE status = 'SUCCESS')*1.0000) / (COUNT(txn_id)*1.0000) AS \"SR\" \nFROM (with ti as (\nselect \n-- date_Trunc('minute',cast(created_on as timestamp)) time_,\ncreated_on,\ntxn_id,\namount,\napp_resp_code,\nnpci_resp_code,\ncase when  status in('SUCCESS','DEEMED') then 'SUCCESS' else status end as status,\ncase when\n        (category= 'VPA2MERCHANT') and business_type = 'MANDATE'\n                then 'MANDATE'                \n    when category in ('VPA2VPA','VPA2ACCOUNT') and (business_type is null or business_type <> 'MANDATE')\n        then 'P2P'        \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM_QR_MERCHANTS'\n        then 'Paytm QR'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('00','01','15','22','23')\n        then '3P QR'\n    when type = 'COLLECT' and category = 'VPA2MERCHANT' and (business_type is null or business_type <> 'MANDATE')\n        then 'P2M Collect'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) = 'PAYTM'\n        and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') in ('04','03')\n        then 'Intent'\n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_3P_NATIVE')\n        then 'Intent'                \n    when type = 'PAY' and category = 'VPA2MERCHANT' and upper(channel_code) in ('ONLINE_ONUS_NATIVE')\n        then 'Onus_ExcMandates'\n    when type = 'PAY' and category = 'VPA2MERCHANT'\n        then 'Other P2M'\n    else 'Others'\n    end flow_cat\n            FROM hive.switch.txn_info_snapshot_v3\n            WHERE dl_last_updated >= current_date - interval '01' day\n            and date(created_on) >= current_date - interval '01' day\n            and type in ('PAY','COLLECT')\n            AND category in('VPA2VPA','VPA2ACCOUNT','VPA2MERCHANT')\n            --AND status in('SUCCESS','DEEMED')\n            and lower(psp_handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \n            and JSON_EXTRACT_SCALAR(extended_info, '$.initiationMode') !='14'\n            ---<= (cast((current_timestamp AT TIME ZONE 'Asia/Kolkata')as TIMESTAMP) - interval '60' minute)\n),\ntp1 as (\nselect txn_id, vpa payer_vpa,handle payer_handle, scope_cust_id payer_cust_id, account_type,bank_code payer_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day \nand lower(handle) in ('paytm','ptyes','ptaxis','pthdfc','ptsbi') \nand participant_type = 'PAYER'\n),\ntp2 as (\nselect txn_id, vpa payee_vpa,handle payee_handle,bank_code payee_bank from \nhive.switch.txn_participants_snapshot_v3 p\nwhere dl_last_updated >=  current_date - interval '01' day\nand participant_type = 'PAYEE'\n),\non_us_vpa as\n(\nselect lower(merchant_vpa) as onus_vpa\nfrom user_paytm_payments.onus_vpa_base\ngroup by 1\n) \n\nselect \nti.created_on\n,date(ti.created_on) dt\n,date_Trunc('hour',ti.created_on) date_time_hourly\n,ti.txn_id\n,ti.amount\n,coalesce(ti.npci_resp_code,ti.app_resp_code) Error_code\n,ti.status\n--,flow_cat\n,tp1.payer_vpa\n,tp1.payer_handle\n,tp1.payer_cust_id\n,tp1.account_type payer_account_type\n,tp1.payer_bank\n,tp2.payee_bank\n,tp2.payee_handle\n,case when flow_cat = 'MANDATE' and c.onus_vpa is not null then 'Mandate_onus'\nwhen  flow_cat = 'MANDATE' and c.onus_vpa is null then 'Mandate_online'\nwhen flow_cat = '3P QR' and payee_handle in ('pty', 'ptybl', 'ptys','ptsbi','ptyes','pthdfc','ptaxis') then 'Paytm QR'\nelse flow_cat end as flow_cat\n,case when flow_cat IN ('P2P') THEN 'P2P'\n  WHEN flow_cat IN ('3P QR', 'Paytm QR') THEN 'SnP'\n  WHEN flow_cat IN ('Intent', 'P2M Collect') or (flow_cat = 'MANDATE' and c.onus_vpa is null) THEN 'Online'\n  WHEN flow_cat IN ('Onus_ExcMandates','Mandate_Onus') or(flow_cat = 'MANDATE' and c.onus_vpa is not null) THEN 'Onus'\n  else flow_cat end as final_Category,\n  \n  (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date) current_time_\n  \n from  ti  \n join tp1 on ti.txn_id = tp1.txn_id\n join tp2 on ti.txn_id = tp2.txn_id\n left join on_us_vpa c  ON lower(tp2.payee_vpa) = lower(c.onus_vpa)\n WHERE \n(\n(\ndate(created_on)  =  current_Date \nand \ncreated_on <= (select (max(created_on) - interval '10' minute) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\nOr\n(date(created_on)  =  (current_Date - interval '01' day)\nand \ncreated_on <= (select (max(created_on) - interval '10' minute - interval '01' day ) last_time from hive.switch.txn_info_snapshot_v3\nwhere  dl_last_updated = current_date)\n)\n)\n) AS virtual_table \nWHERE payer_account_type = 'CREDIT' GROUP BY hour(created_on), dt ORDER BY \"SR\" DESC\nLIMIT 10000;\n\n",
      "metrics": [
        {
          "aggregate": null,
          "column": null,
          "datasourceWarning": false,
          "expressionType": "SQL",
          "hasCustomLabel": true,
          "label": "SR",
          "optionName": "metric_1pqt874jw2y_8i05n1gotmg",
          "sqlExpression": "(COUNT(txn_id) filter(WHERE status = 'SUCCESS')*1.0000) / (COUNT(txn_id)*1.0000)"
        }
      ],
      "columns": [
        "final_Category",
        "payee_handle",
        "payer_cust_id",
        "flow_cat",
        "payer_account_type",
        "payer_bank",
        "created_on",
        "dt",
        "date_time_hourly",
        "txn_id",
        "amount",
        "Error_code",
        "status",
        "payer_vpa",
        "payer_handle",
        "payee_bank"
      ],
      "groupby_columns": [
        "dt"
      ],
      "filters": [
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_ywmagqx2j8_2a057p4rivq",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "created_on"
        },
        {
          "clause": "WHERE",
          "comparator": "No filter",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_h7qp7i18yl8_680rb9atmkb",
          "isExtra": false,
          "isNew": false,
          "operator": "TEMPORAL_RANGE",
          "sqlExpression": null,
          "subject": "date_time_hourly"
        },
        {
          "clause": "WHERE",
          "comparator": "CREDIT",
          "datasourceWarning": false,
          "expressionType": "SIMPLE",
          "filterOptionName": "filter_wwhbph2t79r_03ksdckqnxzy",
          "isExtra": false,
          "isNew": false,
          "operator": "==",
          "operatorId": "EQUALS",
          "sqlExpression": null,
          "subject": "payer_account_type"
        }
      ],
      "time_range": null
    }
  ]
}